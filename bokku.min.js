var Bokku=function(){this.alert_errors=!1,this.log_info=!0,this.tile_size=16,this.limit_viewport=!1,this.jump_switch=0,this.viewport={x:200,y:200},this.camera={x:0,y:0},this.key={left:!1,right:!1,up:!1},this.player={loc:{x:0,y:0},vel:{x:0,y:0},can_jump:!0},window.onkeydown=this.keydown.bind(this),window.onkeyup=this.keyup.bind(this)};Bokku.prototype.error=function(t){this.alert_errors&&alert(t),this.log_info&&console.log(t)},Bokku.prototype.log=function(t){this.log_info&&console.log(t)},Bokku.prototype.set_viewport=function(t,i){this.viewport.x=t,this.viewport.y=i},Bokku.prototype.keydown=function(t){switch(t.keyCode){case 37:this.key.left=!0;break;case 38:this.key.up=!0;break;case 39:this.key.right=!0}},Bokku.prototype.keyup=function(t){switch(t.keyCode){case 37:this.key.left=!1;break;case 38:this.key.up=!1;break;case 39:this.key.right=!1}},Bokku.prototype.load_map=function(t){if(void 0===t||void 0===t.data||void 0===t.keys)return this.error("Error: Invalid map data!"),!1;this.current_map=t,this.current_map.background=t.background||"#333",this.current_map.gravity=t.gravity||{x:0,y:.3},this.tile_size=t.tile_size||16;var i=this;return this.current_map.width=0,this.current_map.height=0,t.keys.forEach(function(e){t.data.forEach(function(t,a){i.current_map.height=Math.max(i.current_map.height,a),t.forEach(function(t,r){i.current_map.width=Math.max(i.current_map.width,r),t==e.id&&(i.current_map.data[a][r]=e)})})}),this.current_map.width_p=this.current_map.width*this.tile_size,this.current_map.height_p=this.current_map.height*this.tile_size,this.player.loc.x=t.player.x*this.tile_size||0,this.player.loc.y=t.player.y*this.tile_size||0,this.player.colour=t.player.colour||"#000",this.key.left=!1,this.key.up=!1,this.key.right=!1,this.camera={x:0,y:0},this.player.vel={x:0,y:0},this.log("Successfully loaded map data."),!0},Bokku.prototype.get_tile=function(t,i){return this.current_map.data[i]&&this.current_map.data[i][t]?this.current_map.data[i][t]:0},Bokku.prototype.draw_tile=function(t,i,e,a){e&&e.colour&&(a.fillStyle=e.colour,a.fillRect(t,i,this.tile_size,this.tile_size))},Bokku.prototype.draw_map=function(t,i){for(var e=0;e<this.current_map.data.length;e++)for(var a=0;a<this.current_map.data[e].length;a++)if(!i&&!this.current_map.data[e][a].fore||i&&this.current_map.data[e][a].fore){var r=a*this.tile_size-this.camera.x,s=e*this.tile_size-this.camera.y;if(r<-this.tile_size||s<-this.tile_size||r>this.viewport.x||s>this.viewport.y)continue;this.draw_tile(r,s,this.current_map.data[e][a],t)}i||this.draw_map(t,!0)},Bokku.prototype.move_player=function(){var tX=this.player.loc.x+this.player.vel.x,tY=this.player.loc.y+this.player.vel.y,offset=Math.round(this.tile_size/2-1),tile=this.get_tile(Math.round(this.player.loc.x/this.tile_size),Math.round(this.player.loc.y/this.tile_size));tile.gravity?(this.player.vel.x+=tile.gravity.x,this.player.vel.y+=tile.gravity.y):(this.player.vel.x+=this.current_map.gravity.x,this.player.vel.y+=this.current_map.gravity.y),tile.friction&&(this.player.vel.x*=tile.friction.x,this.player.vel.y*=tile.friction.y);var t_y_up=Math.floor(tY/this.tile_size),t_y_down=Math.ceil(tY/this.tile_size),y_near1=Math.round((this.player.loc.y-offset)/this.tile_size),y_near2=Math.round((this.player.loc.y+offset)/this.tile_size),t_x_left=Math.floor(tX/this.tile_size),t_x_right=Math.ceil(tX/this.tile_size),x_near1=Math.round((this.player.loc.x-offset)/this.tile_size),x_near2=Math.round((this.player.loc.x+offset)/this.tile_size),top1=this.get_tile(x_near1,t_y_up),top2=this.get_tile(x_near2,t_y_up),bottom1=this.get_tile(x_near1,t_y_down),bottom2=this.get_tile(x_near2,t_y_down),left1=this.get_tile(t_x_left,y_near1),left2=this.get_tile(t_x_left,y_near2),right1=this.get_tile(t_x_right,y_near1),right2=this.get_tile(t_x_right,y_near2);if(tile.jump&&this.jump_switch>15?(this.player.can_jump=!0,this.jump_switch=0):this.jump_switch++,this.player.vel.x=Math.min(Math.max(this.player.vel.x,-this.current_map.vel_limit.x),this.current_map.vel_limit.x),this.player.vel.y=Math.min(Math.max(this.player.vel.y,-this.current_map.vel_limit.y),this.current_map.vel_limit.y),this.player.loc.x+=this.player.vel.x,this.player.loc.y+=this.player.vel.y,this.player.vel.x*=.9,left1.solid||left2.solid||right1.solid||right2.solid){for(;this.get_tile(Math.floor(this.player.loc.x/this.tile_size),y_near1).solid||this.get_tile(Math.floor(this.player.loc.x/this.tile_size),y_near2).solid;)this.player.loc.x+=.1;for(;this.get_tile(Math.ceil(this.player.loc.x/this.tile_size),y_near1).solid||this.get_tile(Math.ceil(this.player.loc.x/this.tile_size),y_near2).solid;)this.player.loc.x-=.1;var bounce=0;left1.solid&&left1.bounce>bounce&&(bounce=left1.bounce),left2.solid&&left2.bounce>bounce&&(bounce=left2.bounce),right1.solid&&right1.bounce>bounce&&(bounce=right1.bounce),right2.solid&&right2.bounce>bounce&&(bounce=right2.bounce),this.player.vel.x*=-bounce||0}if(top1.solid||top2.solid||bottom1.solid||bottom2.solid){for(;this.get_tile(x_near1,Math.floor(this.player.loc.y/this.tile_size)).solid||this.get_tile(x_near2,Math.floor(this.player.loc.y/this.tile_size)).solid;)this.player.loc.y+=.1;for(;this.get_tile(x_near1,Math.ceil(this.player.loc.y/this.tile_size)).solid||this.get_tile(x_near2,Math.ceil(this.player.loc.y/this.tile_size)).solid;)this.player.loc.y-=.1;var bounce=0;top1.solid&&top1.bounce>bounce&&(bounce=top1.bounce),top2.solid&&top2.bounce>bounce&&(bounce=top2.bounce),bottom1.solid&&bottom1.bounce>bounce&&(bounce=bottom1.bounce),bottom2.solid&&bottom2.bounce>bounce&&(bounce=bottom2.bounce),this.player.vel.y*=-bounce||0,!bottom1.solid&&!bottom2.solid||tile.jump||(this.player.on_floor=!0,this.player.can_jump=!0)}var c_x=Math.round(this.player.loc.x-this.viewport.x/2),c_y=Math.round(this.player.loc.y-this.viewport.y/2),x_dif=Math.abs(c_x-this.camera.x),y_dif=Math.abs(c_y-this.camera.y);if(x_dif>5){var mag=Math.round(Math.max(1,.1*x_dif));c_x!=this.camera.x&&(this.camera.x+=c_x>this.camera.x?mag:-mag,this.limit_viewport&&(this.camera.x=Math.min(this.current_map.width_p-this.viewport.x+this.tile_size,this.camera.x),this.camera.x=Math.max(0,this.camera.x)))}if(y_dif>5){var mag=Math.round(Math.max(1,.1*y_dif));c_y!=this.camera.y&&(this.camera.y+=c_y>this.camera.y?mag:-mag,this.limit_viewport&&(this.camera.y=Math.min(this.current_map.height_p-this.viewport.y+this.tile_size,this.camera.y),this.camera.y=Math.max(0,this.camera.y)))}this.last_tile!=tile.id&&tile.script&&eval(this.current_map.scripts[tile.script]),this.last_tile=tile.id},Bokku.prototype.update_player=function(){this.key.left&&this.player.vel.x>-this.current_map.vel_limit.x&&(this.player.vel.x-=this.current_map.movement_speed.left),this.key.up&&this.player.can_jump&&this.player.vel.y>-this.current_map.vel_limit.y&&(this.player.vel.y-=this.current_map.movement_speed.jump,this.player.can_jump=!1),this.key.right&&this.player.vel.x<this.current_map.vel_limit.x&&(this.player.vel.x+=this.current_map.movement_speed.left),this.move_player()},Bokku.prototype.draw_player=function(t){t.fillStyle=this.player.colour,t.beginPath(),t.arc(this.player.loc.x+this.tile_size/2-this.camera.x,this.player.loc.y+this.tile_size/2-this.camera.y,this.tile_size/2-1,0,2*Math.PI),t.fill()},Bokku.prototype.update=function(){this.update_player()},Bokku.prototype.draw=function(t){this.draw_map(t,!1),this.draw_player(t)};var playmusic=!0,source="https://cdn.jsdelivr.net/gh/Dheirya/games/Bokkugurado.mp3",audio=document.createElement("audio");function musicPlay(){playmusic?(document.querySelector(".closeimg").src="https://res.cloudinary.com/mjkui/image/upload/v1642373699/music-icon-transparent-10_ezroib.png",audio.play(),localStorage.setItem("audio","True")):(document.querySelector(".closeimg").src="https://res.cloudinary.com/mjkui/image/upload/v1642373904/Screen-Shot-2022-01-15-at-7-26-42-PM-removebg-preview_bifbhl.png",audio.pause(),localStorage.setItem("audio","False"))}function stopmusic(){playmusic=!playmusic,musicPlay()}"False"==localStorage.getItem("audio")?(playmusic=!1,audio.pause(),musicPlay(),document.querySelector(".closeimg").src="https://res.cloudinary.com/mjkui/image/upload/v1642373904/Screen-Shot-2022-01-15-at-7-26-42-PM-removebg-preview_bifbhl.png",audio.autoplay=!1):audio.autoplay=!0,audio.loop=!0,audio.load(),audio.addEventListener("load",function(){musicPlay()},!0),document.addEventListener("keydown",musicPlay),audio.src=source;
